<!DOCTYPE html>
<html>

    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <title></title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link rel="stylesheet" href="../css/doanhthu.css ">

        <!--css-->
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
        <link href="{% static 'app/css/style.css' %}" rel="stylesheet" />
        <link href="{% static 'app/css/owl.caroysel.min.css' %}" rel="stylesheet" />
        <link href="{% static 'app/css/all.min.css' %}" rel="stylesheet" />
        <!-- js -->
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
        <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js" integrity="sha384-I7E8VVD/ismYTF4hNIPjVp/Zjvgyol6VFvRkX/vR+Vc4jQkC+hVqc2pM8ODewa9r" crossorigin="anonymous"></script>
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.min.js" integrity="sha384-0pUGZvbkm6XF6gxjEnlmuGrJXVbNuzT9qBBavbLwCsOGabYfZo0T0to5eqruptLy" crossorigin="anonymous"></script>
      
        <script src="{% static 'app/js/s3.js' %}"> </script>
        <script src="{% static 'app/js/all.min.js' %}"> </script>
        <script src="{% static 'app/js/m√Ωcript.js' %}"> </script>

        <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">


        <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>


        <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">


        <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" rel="stylesheet">
    </head>
   
    <body>
        <header class="header">
            <div class="menu-toggle">‚ò∞</div>
            <div class="header-title">Nh√† tr·ªç C·∫ßn Th∆°</div>

            
          </div>
          </header>
        
          <div class="sidebar">
               <div class="logo_content">
                
                <div class="logo">
                  <div class="icon">
                    <img src="../imag/moi.jpg" alt="Logo">
                  </div>
                  <div class="logo_name">Xin ch√†o, admin</div>
                </div>
                
            </div>

           <!--<div class="logo_name">Xin ch√†o, Admin</div> -->

           <ul class="nav_list">
            <li>
              <a href="menu.html">
                <span class="icon">üè†</span>
                <span class="link_name">Trang ch·ªß</span>
              </a>
            </li>
            <ul class="nav_list">
              <li>
                <a href="Quanlykhachhang.html">
                  <span class="icon">üßë‚Äçüíº</span>
                  <span class="link_name">Qu·∫£n l√Ω kh√°ch h√†ng</span>
                </a>
              </li>
            <li>
              <a href="doanhthu.html">
                <span class="icon"> üí∞</span>
                <span class="link_name"> doanh thu</span>
              </a>
            </li>
            <li>
              <a href="dichvu.html">
                <span class="icon">üí°</span>
                <span class="link_name">D·ªãch v·ª•</span>
              </a>
            </li>
            
            <!-- <li>
              <a href="dichvu.html">
                <span class="icon">üìä</span>
                <span class="link_name">Ch·ªâ s·ªë ƒëi·ªán n∆∞·ªõc</span>
              </a>
            </li> -->
            <li>
              <a href="hoadon.html">
                <span class="icon">üßæ</span>
                <span class="link_name">H√≥a ƒë∆°n</span>
              </a>
            </li>
        
            <li>
              <a href="quanlihopdong.html">
                <span class="icon">üìÇ</span>
                <span class="link_name">Qu·∫£n l√Ω h·ª£p ƒë·ªìng</span>
              </a>
            </li>
            <li>
              <a href="dangxuat.html" class="logout-link">
                <span class="icon"><i class="fas fa-sign-out-alt"></i></span>
                <span class="link_name">ƒêƒÉng Xu·∫•t</span>
              </a>
            </li>
          </ul>
          </div>
    





          <div class="content flex-grow-1 p-4">
            <!-- Thanh c√¥ng c·ª• ph√≠a tr√™n -->
            <div class="topbar d-flex justify-content-between align-items-center mb-4">
             
                <div>
       
                </div>
            </div>


            
        <!-- Th√¢n -->
    <div class="coner">
      <div class="calendar-header">
        <!--i class="fas fa-calendar-alt"></!i-->
        <input type="month" id="month-year-picker" value="2025-03">
    </div>

      <div class="dashboard">
          <div class="card">
              <i class="fas fa-chart-line"></i>
              <div class="card-content" onclick="document.location='themphong.html'">
                  <h3>T·ªïng thu th√°ng</h3>
                  <p class="total-revenue" data-value="123456">‚Ç´123,456</p>
              </div>
          </div>
          <div class="card">
              <i class="fas fa-money-bill-wave"></i>
              <div class="card-content">
                  <h3>Chi ti√™u s·ª≠a ch·ªØa</h3>
                  <p class="repair-cost" data-value="45678">‚Ç´45,678</p>
              </div>
          </div>
          <div class="card">
              <i class="fas fa-exclamation-triangle"></i>
              <div class="card-content" onclick="document.location='hoadon.html'">
                  <h3>T·ªïng ti·ªÅn ph√≤ng c√≤n n·ª£</h3>
                  <p class="debt" data-value="10000">‚Ç´10,000</p>
              </div>
          </div>
      </div>
  </div>

  <header class="dau">
    <div class="chart-container">
        <div class="chart-box">
            <div class="title">DOANH THU TH√ÅNG</div>
            <canvas id="barChart" 
                    data-revenue='[15000000, 30000000, 55000000, 65000000, 60000000, 75000000, 90000000]' 
                    data-debt='[10000000, 25000000, 40000000, 60000000, 58000000, 65000000, 70000000]'></canvas>
        </div>
        <div class="chart-box">
            <div class="title">T·ªîNG THU/CHI C·ª¶A TH√ÅNG</div>
            <canvas id="barChart2" 
                    data-income='[15000000, 30000000, 55000000, 65000000, 60000000, 75000000, 90000000]' 
                    data-expense='[10000000, 25000000, 40000000, 60000000, 58000000, 65000000, 70000000]'></canvas>
        </div>
    </div>

    <div class="wrapper">
      <div class="tai">
          <div class="box">
              <div class="tit">T·ªîNG THU CHI C·ª¶A NƒÇM <a href="#" class="all">Xem t·∫•t c·∫£</a></div>
              <canvas id="lineChart" 
              data-2020-total-revenue='[50, 100, 130, 160, 190, 200, 270, 300, 320, 340, 360, 380]' 
              data-2020-total-expense='[10, 30, 50, 70, 80, 90, 110, 130, 150, 170, 190, 210]'
              data-2021-total-revenue='[60, 110, 140, 170, 200, 210, 280, 310, 330, 350, 370, 390]' 
              data-2021-total-expense='[20, 40, 60, 80, 90, 100, 120, 140, 160, 180, 200, 220]'
              data-2022-total-revenue='[70, 120, 150, 180, 210, 220, 290, 320, 340, 360, 380, 400]' 
              data-2022-total-expense='[30, 50, 70, 90, 100, 110, 130, 150, 170, 190, 210, 230]'
              data-2023-total-revenue='[80, 130, 160, 190, 220, 230, 300, 330, 350, 370, 390, 410]' 
              data-2023-total-expense='[40, 60, 80, 100, 110, 120, 140, 160, 180, 200, 220, 240]'
              data-2024-total-revenue='[90, 140, 170, 200, 230, 240, 310, 340, 360, 380, 400, 420]' 
              data-2024-total-expense='[50, 70, 90, 110, 120, 130, 150, 170, 190, 210, 230, 250]'
              data-2025-total-revenue='[100, 150, 180, 210, 240, 250, 320, 350, 370, 390, 410, 430]' 
              data-2025-total-expense='[60, 80, 100, 120, 130, 140, 160, 180, 200, 220, 240, 260]'
              data-2026-total-revenue='[110, 160, 190, 220, 250, 260, 330, 360, 380, 400, 420, 440]' 
              data-2026-total-expense='[70, 90, 110, 130, 140, 150, 170, 190, 210, 230, 250, 270]'></canvas>
          </div>
      </div>
  
      <div class="calendar-container">
          <div class="calendar-header">
              <span class="arrow" onclick="prevDecade()">‚ùÆ</span>
              <span class="year" id="decadeDisplay">2020 - 2027</span>
              <span class="arrow" onclick="nextDecade()">‚ùØ</span>
          </div>
          <div class="year-list" id="yearList"></div>
      </div>
  </div>
</header>

<!-- JavaScript -->
<script>
  // H√†m kh·ªüi t·∫°o bi·ªÉu ƒë·ªì 1 v√† 2
  window.onload = function() {
      // Bi·ªÉu ƒë·ªì 1: ƒê√∫ng h·∫°n / N·ª£
      const barChartElement = document.getElementById('barChart');
      const revenueData = JSON.parse(barChartElement.getAttribute('data-revenue') || '[]');
      const debtData = JSON.parse(barChartElement.getAttribute('data-debt') || '[]');
      const barCtx = barChartElement.getContext('2d');

      new Chart(barCtx, {
          type: 'bar',
          data: {
              labels: ['T.1', 'T.2', 'T.3', 'T.4', 'T.5', 'T.6', 'T.7', 'T.8', 'T.9', 'T.10', 'T.11', 'T.12'],
              datasets: [
                  { label: 'ƒê√∫ng h·∫°n', data: revenueData, backgroundColor: '#60a5fa' },
                  { label: 'N·ª£', data: debtData, backgroundColor: '#bfdbfe' }
              ]
          },
          options: {
              scales: {
                  y: {
                      ticks: {
                          callback: function(value) {
                              return value.toLocaleString('vi-VN') + ' VND';
                          }
                      }
                  }
              }
          }
      });

      // Bi·ªÉu ƒë·ªì 2: Thu / Chi
      const barChart2Element = document.getElementById('barChart2');
      const incomeData = JSON.parse(barChart2Element.getAttribute('data-income') || '[]');
      const expenseData = JSON.parse(barChart2Element.getAttribute('data-expense') || '[]');
      const barCtx2 = barChart2Element.getContext('2d');

      new Chart(barCtx2, {
          type: 'bar',
          data: {
              labels: ['T.1', 'T.2', 'T.3', 'T.4', 'T.5', 'T.6', 'T.7', 'T.8', 'T.9', 'T.10', 'T.11', 'T.12'],
              datasets: [
                  { label: 'Thu', data: incomeData, backgroundColor: '#67be91' },
                  { label: 'Chi', data: expenseData, backgroundColor: '#90f7eb' }
              ]
          },
          options: {
              scales: {
                  y: {
                      ticks: {
                          callback: function(value) {
                              return value.toLocaleString('vi-VN') + ' VND';
                          }
                      }
                  }
              }
          }
      });
  };
</script>

<script>
// Khai b√°o bi·∫øn to√†n c·ª•c
let startYear = 2020;
let selectedYear = 2025;
let lineChart; // Bi·∫øn ƒë·ªÉ l∆∞u bi·ªÉu ƒë·ªì

// H√†m kh·ªüi t·∫°o ho·∫∑c c·∫≠p nh·∫≠t bi·ªÉu ƒë·ªì ƒë∆∞·ªùng
function updateLineChart() {
    const lineChartElement = document.getElementById('lineChart');
    const lineCtx = lineChartElement.getContext('2d');

    // T·∫°o danh s√°ch nh√£n (7 nƒÉm t·ª´ startYear)
    const labels = [];
    for (let i = 0; i < 7; i++) {
        labels.push(startYear + i);
    }

    // T·∫°o m·∫£ng d·ªØ li·ªáu cho 7 nƒÉm
    const totalRevenueData = [];
    const totalExpenseData = [];
    for (let i = 0; i < 7; i++) {
        const year = startYear + i;
        const revenue = JSON.parse(lineChartElement.getAttribute(`data-${year}-total-revenue`) || '[]');
        const expense = JSON.parse(lineChartElement.getAttribute(`data-${year}-total-expense`) || '[]');
        // T√≠nh t·ªïng thu/chi c·ªßa t·ª´ng nƒÉm (gi·∫£ s·ª≠ d·ªØ li·ªáu l√† m·∫£ng 12 th√°ng)
        const totalRevenue = revenue.reduce((sum, value) => sum + value, 0);
        const totalExpense = expense.reduce((sum, value) => sum + value, 0);
        totalRevenueData.push(totalRevenue);
        totalExpenseData.push(totalExpense);
    }

    // N·∫øu bi·ªÉu ƒë·ªì ƒë√£ t·ªìn t·∫°i, h·ªßy n√≥ tr∆∞·ªõc khi t·∫°o m·ªõi
    if (lineChart) {
        lineChart.destroy();
    }

    // T·∫°o bi·ªÉu ƒë·ªì m·ªõi v·ªõi nh√£n l√† c√°c nƒÉm
    lineChart = new Chart(lineCtx, {
        type: 'line',
        data: {
            labels: labels, // Nh√£n l√† 7 nƒÉm
            datasets: [
                { 
                    label: 'T·ªïng thu', 
                    data: totalRevenueData, 
                    borderColor: '#60a5fa', 
                    fill: true 
                },
                { 
                    label: 'Chi tr·∫£', 
                    data: totalExpenseData, 
                    borderColor: '#93c5fd', 
                    fill: true 
                }
            ]
        },
        options: {
            scales: {
                y: {
                    ticks: {
                        callback: function(value) {
                            return value.toLocaleString('vi-VN'); // ƒê·ªãnh d·∫°ng s·ªë
                        }
                    }
                }
            },
            plugins: {
                title: {
                    display: true,
                    text: `So S√°nh T·ªïng Thu/Chi (${startYear} - ${startYear + 6})`, // Ti√™u ƒë·ªÅ ƒë·ªông theo kho·∫£ng nƒÉm
                    font: {
                        size: 16
                    }
                }
            }
        }
    });
}
// [Th√™m] H√†m kh·ªüi t·∫°o ho·∫∑c c·∫≠p nh·∫≠t bi·ªÉu ƒë·ªì 12 th√°ng c·ªßa nƒÉm ƒë∆∞·ª£c ch·ªçn
function updateYearlyChart(year) {
  const lineChartElement = document.getElementById('lineChart'); // L·∫•y d·ªØ li·ªáu t·ª´ lineChart
  const yearlyChartElement = document.getElementById('yearlyChart');
  const yearlyCtx = yearlyChartElement.getContext('2d');

  const revenue = JSON.parse(lineChartElement.getAttribute(`data-${year}-total-revenue`) || '[]');
  const expense = JSON.parse(lineChartElement.getAttribute(`data-${year}-total-expense`) || '[]');

  if (yearlyChart) {
      yearlyChart.destroy();
  }

  yearlyChart = new Chart(yearlyCtx, {
      type: 'line',
      data: {
          labels: ['T.1', 'T.2', 'T.3', 'T.4', 'T.5', 'T.6', 'T.7', 'T.8', 'T.9', 'T.10', 'T.11', 'T.12'],
          datasets: [
              { 
                  label: 'T·ªïng thu', 
                  data: revenue, 
                  borderColor: '#60a5fa', 
                  fill: true 
              },
              { 
                  label: 'Chi tr·∫£', 
                  data: expense, 
                  borderColor: '#93c5fd', 
                  fill: true 
              }
          ]
      },
      options: {
          scales: {
              y: {
                  ticks: {
                      callback: function(value) {
                          return value.toLocaleString('vi-VN');
                      }
                  }
              }
          },
          plugins: {
              title: {
                  display: true,
                  text: `T·ªïng Thu/Chi NƒÉm ${year}`,
                  font: { size: 16 }
              }
          }
      }
  });
}
// H√†m render danh s√°ch nƒÉm
function renderYearList() {
    document.getElementById("decadeDisplay").textContent = `${startYear} - ${startYear + 7}`;
    const yearList = document.getElementById("yearList");
    yearList.innerHTML = "";
    
    for (let i = 0; i < 7; i++) {
        let year = startYear + i;
        let yearElement = document.createElement("div");
        yearElement.classList.add("year");
        yearElement.textContent = year;
        if (year === selectedYear) {
            yearElement.classList.add("selected-year");
        }
        yearElement.onclick = () => {
            selectedYear = year;
            renderYearList(); // C·∫≠p nh·∫≠t giao di·ªán l·ªãch
            updateYearlyChart(selectedYear); // [Th√™m] C·∫≠p nh·∫≠t bi·ªÉu ƒë·ªì 12 th√°ng khi ch·ªçn nƒÉm
            // Kh√¥ng c·∫ßn g·ªçi updateLineChart ·ªü ƒë√¢y v√¨ ch·ªâ c·∫ßn so s√°nh 7 nƒÉm
        };
        yearList.appendChild(yearElement);
    }
}

// H√†m chuy·ªÉn th·∫≠p ni√™n tr∆∞·ªõc
function prevDecade() {
    startYear -= 7;
    renderYearList();
    updateLineChart(); // C·∫≠p nh·∫≠t bi·ªÉu ƒë·ªì khi chuy·ªÉn th·∫≠p ni√™n
    updateYearlyChart(selectedYear); // [Th√™m] C·∫≠p nh·∫≠t bi·ªÉu ƒë·ªì 12 th√°ng cho nƒÉm ƒë∆∞·ª£c ch·ªçn
}

// H√†m chuy·ªÉn th·∫≠p ni√™n sau
function nextDecade() {
    startYear += 7;
    renderYearList();
    updateLineChart(); // C·∫≠p nh·∫≠t bi·ªÉu ƒë·ªì khi chuy·ªÉn th·∫≠p ni√™n
}

// Kh·ªüi t·∫°o l·ªãch nƒÉm v√† bi·ªÉu ƒë·ªì ƒë∆∞·ªùng
window.addEventListener('load', function() {
    renderYearList();
    updateLineChart(); // Hi·ªÉn th·ªã bi·ªÉu ƒë·ªì cho kho·∫£ng nƒÉm m·∫∑c ƒë·ªãnh (2020-2026)
});
</script>
</body>
</html>

